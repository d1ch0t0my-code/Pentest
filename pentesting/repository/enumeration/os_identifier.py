#!/usr/bin/python3

###################################################################
# Script Name : OS Identifier
# date        : 20220624
# usage       : python os_identifier.py <target-ip-address>
# Author      : d1ch0t0my
# Email       : d1ch0t0my@protonmail.com
# Description : Script to identify the target OS
###################################################################

import subprocess, time, sys, re, os

def return_ttl(address):
	cmd='ping -c 1 %s' % (address)
	proc = subprocess.Popen(cmd.split(), stdout=subprocess.PIPE)
	(out, err) = proc.communicate()
	out = out.decode('utf-8')
	if out.find('100% packet loss') >= 0:
		return (-1)
	out = out.split()
	out = re.search(r'\d+', out[12])

	return int(out.group())

def return_ttl_os_name(ttl_number):
    if ttl_number == -1:
    	return 'Target does NOT respond'
    if ttl_number >= 0 and ttl_number <= 64:
        return 'Linux'
    elif ttl_number >= 65 and ttl_number <= 128:
        return 'Windows'
    else:
        return 'Unknown'

if len(sys.argv) != 2:
    print('[!] ERROR: Not enough arguments')
    print('[i] Usage: python ' + sys.argv[0] + ' <target-ip-address>\n')
    sys.exit(1)

if __name__ == '__main__':
    addr = sys.argv[1]
    ttl = return_ttl(addr)

    try:
        print('%s -> %s\n' % (addr, return_ttl_os_name(int(ttl))))

    except:
        pass
